<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCIENCE BATTLE ROYALE 60Q ðŸš€</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Anuphan:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6c5ce7; --accent: #fdcb6e; --bg: #0984e3; --dark: #2d3436; --white: #ffffff; }
        * { box-sizing: border-box; font-family: 'Fredoka', 'Anuphan', sans-serif; }
        body { background: var(--bg); margin: 0; overflow: hidden; color: var(--dark); display: flex; align-items: center; justify-content: center; height: 100vh; }
        
        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 4px solid var(--dark); border-radius: 30px; padding: 30px; width: 95%; max-width: 700px; text-align: center; box-shadow: 12px 12px 0 rgba(0,0,0,0.2); position: relative; max-height: 90vh; overflow-y: auto; }
        .player-tag { background: var(--primary); color: white; padding: 8px 15px; border-radius: 15px; margin: 5px; display: inline-block; font-weight: bold; border: 2px solid var(--dark); }
        
        .btn-start { background: #00b894; color: white; border: 3px solid var(--dark); padding: 15px 40px; border-radius: 50px; font-size: 1.2rem; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .btn-start:disabled { background: #ccc; cursor: not-allowed; opacity: 0.7; }
        
        .ans-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ans-btn { padding: 20px; border: none; border-radius: 15px; color: white; font-size: 1rem; font-weight: 700; cursor: pointer; border-bottom: 5px solid rgba(0,0,0,0.2); }
        .b0 { background: #e21b3c; } .b1 { background: #1368ce; } .b2 { background: #d89e00; } .b3 { background: #26890c; }
        
        .effect-shake { animation: shake 0.2s infinite; }
        @keyframes shake { 0%{transform:translate(2px,2px)} 50%{transform:translate(-2px,-2px)} 100%{transform:translate(2px,2px)} }
        .effect-blind { filter: brightness(0.1) blur(20px); }
        .effect-flip { transform: rotate(180deg); }
        .hidden { display: none !important; }

        .winner-crown { font-size: 4rem; display: block; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% {transform: translateY(0)} 50% {transform: translateY(-15px)} }
        
        #victim-list button { margin: 10px; padding: 10px 20px; background: #ff7675; color: white; border: 2px solid black; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

<audio id="snd-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="snd-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
<audio id="snd-win" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

<div id="view-lobby" class="card">
    <h1 style="color: var(--primary);">SCIENCE BATTLE 60Q</h1>
    <p id="status-msg" style="font-weight: bold; color: #d63031;">Join a room to start!</p>
    <input type="text" id="name-in" placeholder="Your Name" style="width:60%; padding:12px; margin:5px; border-radius:10px; border:2px solid black;">
    <input type="text" id="room-in" placeholder="Room ID" style="width:60%; padding:12px; margin:5px; border-radius:10px; border:2px solid black;">
    <br><button class="btn-start" onclick="game.join()">JOIN</button>
    <div id="player-list" style="margin: 20px 0;"></div>
    <button id="start-btn" class="btn-start hidden" style="background:#6c5ce7" onclick="game.startReq()" disabled>START GAME (Min 3 players)</button>
</div>

<div id="view-quiz" class="card hidden">
    <div id="progress" style="height:10px; background:var(--accent); width:0%; position:absolute; top:0; left:0;"></div>
    <div id="q-num" style="font-weight: bold; margin-bottom: 10px;">Question 1/60</div>
    <h2 id="q-text"></h2>
    <div class="ans-grid" id="ans-grid"></div>
</div>

<div id="view-finish" class="card hidden">
    <span class="winner-crown">ðŸ‘‘</span>
    <h1 id="winner-name">...</h1>
    <h2>WINNER!</h2>
    <div id="final-stats"></div>
    <button class="btn-start" onclick="location.reload()">HOME</button>
</div>

<div id="sabotage-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; flex-direction:column; align-items:center; justify-content:center; color:white;">
    <h2>âš¡ CORRECT! ATTACK SOMEONE! âš¡</h2>
    <div id="victim-list"></div>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAVAd78Y9OUKFdfkPsV96uj2IjFwWu1rAc",
    authDomain: "mark-d1f3f.firebaseapp.com",
    databaseURL: "https://mark-d1f3f-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "mark-d1f3f",
    storageBucket: "mark-d1f3f.firebasestorage.app",
    messagingSenderId: "937114827864",
    appId: "1:937114827864:web:24906a17f19c510714de2d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const questions = [
    {q: "Which simple machine has a fulcrum?", a: ["Pulley", "Lever", "Wedge", "Screw"], c: 1},
    {q: "Energy due to motion is...", a: ["Potential", "Thermal", "Kinetic", "Solar"], c: 2},
    {q: "What unit measures Force?", a: ["Watt", "Joule", "Newton", "Gram"], c: 2},
    {q: "A wheelbarrow is which class of lever?", a: ["1st", "2nd", "3rd", "None"], c: 1},
    {q: "Inclined plane wrapped around a cylinder is a...", a: ["Wedge", "Screw", "Lever", "Axle"], c: 1},
    {q: "Rate of doing work is called...", a: ["Force", "Energy", "Power", "Mass"], c: 2},
    {q: "Unit of Work is...", a: ["Newton", "Joule", "Watt", "Pascal"], c: 1},
    {q: "A pair of scissors is which class of lever?", a: ["1st", "2nd", "3rd", "4th"], c: 0},
    {q: "Stored energy is called...", a: ["Kinetic", "Potential", "Light", "Sound"], c: 1},
    {q: "Fixed pulley changes the ___ of force.", a: ["Amount", "Direction", "Mass", "Speed"], c: 1},
    {q: "Formula for Potential Energy is...", a: ["1/2mv^2", "mgh", "Fd", "P/t"], c: 1},
    {q: "Formula for Kinetic Energy is...", a: ["mgh", "Fd", "1/2mv^2", "ma"], c: 2},
    {q: "Tweezers are which class of lever?", a: ["1st", "2nd", "3rd", "None"], c: 2},
    {q: "Mechanical Advantage of 1 means...", a: ["Easier", "Harder", "No change in force", "Broken"], c: 2},
    {q: "A knife is an example of a...", a: ["Lever", "Pulley", "Wedge", "Screw"], c: 2},
    {q: "Friction converts Kinetic energy into...", a: ["Solar", "Heat", "Nuclear", "Potential"], c: 1},
    {q: "Standard gravity on Earth is ___ m/sÂ².", a: ["1.6", "5.0", "9.8", "12.0"], c: 2},
    {q: "Fishing rod is a ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 2},
    {q: "Work = Force x ___.", a: ["Time", "Mass", "Distance", "Velocity"], c: 2},
    {q: "1 Watt is equal to 1 ___ per second.", a: ["Newton", "Joule", "Gram", "Meter"], c: 1},
    {q: "Nutcracker is a ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 1},
    {q: "A slide is which simple machine?", a: ["Wedge", "Inclined Plane", "Lever", "Pulley"], c: 1},
    {q: "Total mechanical energy is PE + ___.", a: ["Heat", "KE", "Light", "Sound"], c: 1},
    {q: "Efficiency is always less than ___ percent.", a: ["50", "90", "100", "200"], c: 2},
    {q: "Human elbow is a ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 2},
    {q: "Energy cannot be created or ___.", a: ["Used", "Moved", "Destroyed", "Stored"], c: 2},
    {q: "Unit of Power is...", a: ["Newton", "Joule", "Watt", "Volt"], c: 2},
    {q: "A flag pole uses a ___ pulley.", a: ["Movable", "Fixed", "Compound", "Broken"], c: 1},
    {q: "Wedge is used to ___ objects.", a: ["Join", "Rotate", "Split", "Lift"], c: 2},
    {q: "Broom is a ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 2},
    {q: "Screw is an inclined plane wrapped in a ___.", a: ["Circle", "Square", "Spiral", "Triangle"], c: 2},
    {q: "MA stands for Mechanical ___.", a: ["Amount", "Advantage", "Action", "Ability"], c: 1},
    {q: "Bottle opener is a ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 1},
    {q: "A door knob is a ___.", a: ["Pulley", "Wedge", "Wheel and Axle", "Screw"], c: 2},
    {q: "Staircase is an ___.", a: ["Inclined Plane", "Lever", "Wedge", "Pulley"], c: 0},
    {q: "Hammer pulling a nail is a ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 0},
    {q: "Elastic PE is found in a ___.", a: ["Food", "Battery", "Spring", "Sun"], c: 2},
    {q: "If mass increases, PE ___.", a: ["Decreases", "Increases", "Stays same", "Zero"], c: 1},
    {q: "Chemical energy is in ___.", a: ["Springs", "Height", "Batteries", "Speed"], c: 2},
    {q: "Seesaw is a ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 0},
    {q: "Force = Mass x ___.", a: ["Time", "Speed", "Acceleration", "Work"], c: 2},
    {q: "1 HP is approx ___ Watts.", a: ["500", "746", "1000", "1200"], c: 1},
    {q: "Which has a sharp edge?", a: ["Screw", "Wedge", "Pulley", "Lever"], c: 1},
    {q: "Ideal machine has ___ friction.", a: ["High", "Low", "Zero", "Some"], c: 2},
    {q: "Solar panels make ___ energy.", a: ["Heat", "Nuclear", "Electrical", "Sound"], c: 2},
    {q: "Object on a hill has ___ energy.", a: ["KE", "PE", "Sound", "Light"], c: 1},
    {q: "Speeding car has ___ energy.", a: ["PE", "KE", "Nuclear", "Elastic"], c: 1},
    {q: "Crane uses ___ to lift.", a: ["Wedges", "Pulleys", "Screws", "Magnets"], c: 1},
    {q: "Output work / Input work is ___.", a: ["Power", "Advantage", "Efficiency", "Force"], c: 2},
    {q: "Fulcrum in middle = ___ class.", a: ["1st", "2nd", "3rd", "4th"], c: 0},
    {q: "Load in middle = ___ class.", a: ["1st", "2nd", "3rd", "None"], c: 1},
    {q: "Effort in middle = ___ class.", a: ["1st", "2nd", "3rd", "None"], c: 2},
    {q: "A ramp reduces the ___ needed.", a: ["Distance", "Force", "Work", "Time"], c: 1},
    {q: "Joule is N x ___.", a: ["Sec", "Kg", "Meter", "Watt"], c: 2},
    {q: "Law of conservation of ___.", a: ["Mass", "Force", "Energy", "Speed"], c: 2},
    {q: "MA of single fixed pulley is ___.", a: ["0", "1", "2", "Infinity"], c: 1},
    {q: "Pliers are ___ class lever.", a: ["1st", "2nd", "3rd", "None"], c: 0},
    {q: "Zipper uses a ___.", a: ["Lever", "Wedge", "Pulley", "Screw"], c: 1},
    {q: "Engine is a ___ machine.", a: ["Simple", "Complex", "Natural", "Manual"], c: 1},
    {q: "Food contains ___ PE.", a: ["Elastic", "Chemical", "Gravitational", "Nuclear"], c: 1}
];

const game = {
    user: '', room: '', score: 0, qIdx: 0,
    join() {
        this.user = document.getElementById('name-in').value.trim();
        this.room = document.getElementById('room-in').value.trim();
        if(!this.user || !this.room) return alert("Enter name and room!");
        db.ref(`battle/${this.room}/players/${this.user}`).set({ score: 0 });
        db.ref(`battle/${this.room}/status`).on('value', snap => {
            if(snap.val() === 'playing') this.start();
        });
        db.ref(`battle/${this.room}/players`).on('value', snap => {
            const list = document.getElementById('player-list');
            list.innerHTML = ''; let count = 0;
            for(let p in snap.val()) {
                list.innerHTML += `<span class="player-tag">ðŸ‘¤ ${p}</span>`;
                count++;
            }
            if(this.user.toLowerCase() === 'mark') {
                const btn = document.getElementById('start-btn');
                btn.classList.remove('hidden');
                btn.disabled = (count < 3);
                document.getElementById('status-msg').innerText = count < 3 ? `Waiting for 3 players (${count}/3)...` : "Ready to Start!";
            }
        });
        db.ref(`battle/${this.room}/effects/${this.user}`).on('value', snap => {
            if(snap.val()) this.beAttacked(snap.val().type);
        });
    },
    startReq() { db.ref(`battle/${this.room}/status`).set('playing'); },
    start() {
        document.getElementById('view-lobby').classList.add('hidden');
        document.getElementById('view-quiz').classList.remove('hidden');
        this.render();
    },
    render() {
        if(this.qIdx >= 60) return this.finish();
        const q = questions[this.qIdx];
        document.getElementById('q-num').innerText = `Question ${this.qIdx+1}/60`;
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('progress').style.width = ((this.qIdx/60)*100) + "%";
        const grid = document.getElementById('ans-grid'); grid.innerHTML = '';
        q.a.forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = `ans-btn b${i}`; btn.innerText = txt;
            btn.onclick = () => this.check(i); grid.appendChild(btn);
        });
    },
    check(i) {
        if(i === questions[this.qIdx].c) {
            this.score += 1000; document.getElementById('snd-correct').play();
            db.ref(`battle/${this.room}/players/${this.user}/score`).set(this.score);
            this.openSabotage();
        } else {
            document.getElementById('snd-wrong').play();
            this.qIdx++; this.render();
        }
    },
    openSabotage() {
        const modal = document.getElementById('sabotage-modal'); modal.style.display = 'flex';
        const list = document.getElementById('victim-list'); list.innerHTML = '';
        db.ref(`battle/${this.room}/players`).once('value', snap => {
            for(let p in snap.val()) {
                if(p === this.user) continue;
                const b = document.createElement('button'); b.innerText = p;
                b.onclick = () => {
                    const type = ['blind', 'shake', 'flip'][Math.floor(Math.random()*3)];
                    db.ref(`battle/${this.room}/effects/${p}`).set({ type });
                    modal.style.display = 'none'; this.qIdx++; this.render();
                };
                list.appendChild(b);
            }
            if(list.innerHTML === '') { setTimeout(()=> {modal.style.display='none'; this.qIdx++; this.render();}, 500); }
        });
    },
    beAttacked(type) {
        const ui = document.getElementById('view-quiz');
        ui.classList.add(`effect-${type}`);
        setTimeout(() => {
            ui.classList.remove('effect-blind', 'effect-shake', 'effect-flip');
            db.ref(`battle/${this.room}/effects/${this.user}`).remove();
        }, 4000);
    },
    finish() {
        document.getElementById('view-quiz').classList.add('hidden');
        document.getElementById('view-finish').classList.remove('hidden');
        document.getElementById('snd-win').play();
        db.ref(`battle/${this.room}/players`).orderByChild('score').once('value', snap => {
            let res = []; snap.forEach(s => res.push({n: s.key, s: s.val().score}));
            res.reverse();
            document.getElementById('winner-name').innerText = res[0].n;
            document.getElementById('final-stats').innerHTML = res.map(x => `<div>${x.n}: ${x.s} pts</div>`).join('');
        });
    }
};
</script>
</body>
</html>

